---
format_version: '7'
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
project_type: other
trigger_map:
  - push_branch: "master"
    workflow: release
workflows:
  release:
    steps:
      - activate-ssh-key@4.0.3:
          run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
      - git-clone@4.0.14: {}
      - cache-pull@2.0.1: {}
      - gradle-runner@1.8.5:
          inputs:
            - apk_file_include_filter: "*smarthome-*.zip"
            - gradle_task: distZip
      - script@1.1.5:
          inputs:
            - is_debug: 'no'
            - content: |+
                #!/usr/bin/env bash
                version=`grep  "version \'\d*\.\d*\.\d*\'" build.gradle | cut -d" " -f2`
                envman add --key CURRENT_VERSION --value $version
      - cache-push@2.1.1: {}
      - deploy-to-bitrise-io@1.3.19:
          inputs:
            - notify_user_groups: none
          is_always_run: false
app:
  envs:
    - opts:
        is_expand: false
      GRADLEW_PATH: "./gradlew"